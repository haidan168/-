# HTTP协议

## HTTP

- 超文本传输协议（HTTP)是一种**通信协议**，允许将超文本标记语言（HTML）文档从Web服务器传送到客户端的浏览器
- HTTP是一个属于**应用层的面向对象的协议**

## Web与HTTP

- Web是一种基于超文本和HTTP的、全球性的、动态交互的、跨平台的分布式**图形信息系统**
- 建立在Internet上的一种**网络服务**，为浏览器在Internet上查找和浏览信息提供了图形化的、易于访问的直观界面，其中的文档及超级链接将Internet上的信息节点组织成一个互为关联的网状结构

## TCP/IP

- HTTP协议是构建在TCP/IP协议之上的，是TCP/IP协议的一个子集
- TCP/IP协议是一系列与互联网相关联的协议集合起来的总称
- 分层管理是TCP/IP协议的重要特性

### TCP/IP协议族分层

- TCP/IP协议族是由一个四层协议组成的系统，这四层分别为：应用层、传输层、网络层和数据链路层
  - 应用层：HTTP
  - 传输层：TCP
  - 网络层：IP
  - 数据链路层：网络

#### 应用层

- 应用层一般是编写的应用程序
- 决定了向用户提供的应用服务
- 应用层可以通过系统调用与传输层进行通信
- 如：FTP、DNS、HTTP

#### 传输层

- 传输层通过系统调用向应用层提供处于网络连接中的两台计算机之间的数据传输功能
- 在传输层有两个性质不同的协议：
  - TCP
    - 面向连接
    - 可靠效率低
  - UDP
    - 无连接的
    - 不可靠效率高

#### 网络层

- 网络层用来处理在网络上流动的数据包
- 数据包是网络传输的最小数据单位
- 改层规定了通过怎样的路径（传输路径）到达对方计算机，并把数据包传输给对方

#### 链路层

- 链路层用来处理网的硬件部分
  - 包括控制操作系统、硬件设备驱动、NIF（网络适配器）以及光纤等物理课件部分
- 硬件上的范畴均在链路层的作用范围之内

### 数据包的封装过程

![](.\img\02.04-01.png)

### HTTP数据传输过程

- 发送端发送数据时，数据会从上层传输到下层
  - 每经过一层都会被打上该层的头部信息
- 接受数据时，数据会从下层传输到上层
  - 传输前会把下层的头部信息删除

![](.\img\02.04-02.png)

###  传输层-TCP三次握手

![](.\img\02.04-03.png)

|        | 客户端                                                       | 服务器                                           |
| ------ | ------------------------------------------------------------ | ------------------------------------------------ |
| 第一次 |                                                              | 确认客户端的发送功能正常，服务器的接受功能正常   |
| 第二次 | 确认客户端的接受功能和发送功能正常，服务器端的接 受和发送功能正常 |                                                  |
| 第三次 |                                                              | 确认客户端的接受功能正常，服务器端的发送能力正常 |

## DNS域名解析

- TCP/IP协议使用的是IP地址进行访问的
- DNS服务提供**域名到IP地址之间的解析服务**
- 访问一个百度的步骤：
  - 输入百度的域名（www.bai.com)
  - 先从本地的host文件查找，是否有这个网址的映射关系，有就返回
  - 没有查找本地的DNS服务器，本地缓存中，有就返回
  - 没找到继续向上找
    - 设置了转发，会一层一层网上找，直到找到根DNS服务器
    - 没有设置转发，会直接去根DNS服务器查找
- 知道IP地址后就可以找到百度对应的服务器

## HTTP事务处理过程

1. 查询域名的IP地址
   - 需要DNS服务器解析出IP地址
2. 返回域名的IP地址
3. 生成HTTP请求
   - 封装HTTP请求数据包
   - TCP/IP，三次握手后将数据传输给服务器
4. 传输HTTP请求
   - 服务器接受请求，处理数据
5. 生成HTTP回复
   - 将服务器处理好的数据进行返回
6. 传输HTTP回复
   - TCP/IP，三次握手后将数据传输给客户端

# HTTP结构和通讯原理

### HTTP协议的特点

- 支持客户/服务器模式
  - 客户/服务器模式工作的方式是由客户端向服务器发出请求，服务器端响应请求，并进行相应的服务
- 简单快速
  - 客户向服务器请求服务时，只需要传送请求方法和路径
  - 由于HTTP协议简单，是的HTTP服务器的程序规模小，因而通信速度很快
- 灵活
  - HTTP允许传输任意类型的数据对象
  - 正在传输的类型由Content-Type（HTTP包中用来表示内容类型的标识）加以标记
- 无连接
  - 无连接的含义是限制每次连接只处理一个请求
  - 服务器处理完客户的请求，并收到客户的应答后，即断开连接
  - 采用这种方式可以节省传输时间
- 无状态
  - HTTP协议是无状态协议
  - 无状态是指协议对于事物处理没有记忆能力
  - 缺少状态意味着，如果后续需要前面的信息，则它必须重传，这可能导致每次连接传送的数据量增大
  - 所有在服务器不需要之前信息时，它的应答就较快

### URL和URI

- URI可以分为URL、URN或者同事具备locators和names特性的一个东西
  - URN就像一个人的名字，URL就像一个的住址
  - URN确定了东西的身份，URL提供了找到它的方法
- URL是URI的一种，但不是所有URI都是URL
- URI和URL最大的差别就是访问机制
  - HTTP、FTP
- URN是唯一标识的一部分，是身份信息

### HTTP报文结构

#### 请求报文

![](.\img\02.05-01.png)

- 请求行、报文头、报文体

##### HTTP报文头

- HTTP报文头大体可以分为四类：
  - 通用报文头
  - 请求报文头
  - 响应报文头
  - 实体报文头

##### 通用报文头

![](.\img\02.05-02.png)

###### Connection

- Connection: keep-alive
  - 当一个网页打开完成后，客户端和服务器之间用于传输HTTP数据的TCP连接不会关闭，如果客户端再次访问这个服务器上的网页，会继续使用这一条已经建立的链接
- Connection: close
  - 代表一个Request完成后，客户端和服务器之间用于传输HTTP数据的TCP连接会关闭，当客户端再次发送Request，需要重新建立TCP连接

##### 请求报文头

![](.\img\02.05-03.png)

###### Accept

- 浏览器端可以接受的媒体类型
- 如果服务器无法返回该类型的数据，服务器应该会返回一个406错误（Non Acceptable)
- Accept: \*/\*
  - 代表浏览器可以处理所有类型

##### 响应报文头

![](.\img\02.05-04.png)

##### 实体报文头

![](.\img\02.05-05.png)

#### 响应报文

![](.\img\02.05-06.png)

#### HTTP请求方法

![](.\img\02.06-01.png)

#### GET

- 默认的HTTP请求方法
- 用来请求已被URI识别的资源
- 指定的资源经服务器端解析后返回响应内容
- 提交的数据只经过了简单的编码
- 数据会作为url的一部分进行发送
  - 提交的数据量小
  - 存在安全隐患

#### POST

- 功能和GET类型，一般用来传输实体的主体
- 向服务器提交大批量的数据
- 数据在请求主体中
  - 数据不是url的一部分，而是标准的数据
  - 数据没有大小限制

### 状态码

- 用来表示网页服务器超文本传输协议响应状态的3位数字代码

![](.\img\02.06-02.png)

##### 2开头的状态码

![](.\img\02.06-03.png)

##### 3开头的状态码

![](.\img\02.06-04.png)

##### 4开头的状态码

![](.\img\02.06-05.png)

##### 5开头的状态码

![](.\img\02.06-06.png)

### HTTP状态管理

- 会话跟踪技术
  - Cookie
  - Session

##### Cookie

- Cookie是客户端的

![](.\img\02.06-08.png)

##### Session

- Session是服务端的

![](.\img\02.06-09.png)

![](.\img\02.06-07.png)

##### 保存Session ID的方式

- Cookie

- URL重新

  1. 把Session ID直接附加在url后面，作为url的附加信息

  2. 作为一个查询字符串，一个参数放在url的后面

- 隐藏表单

  - 服务器会自动修改表单，添加隐藏的字段，表单提交时，会把Session ID传到服务器端

##### Session的有效时间

- Session超时失效
  - 超过了超时间，还没有访问服务器，Session就会自动失效
- 主动失效
  - 程序调用HttpSession. invalidate()
- 服务器异常终止

##### Cookie与Session的不同

- 存放位置不同
  - cookie：客户端
  - session：服务端
- 安全性（隐式策略）不同
  - cookie：存储在浏览器中，对客户端是可见的，客户端的程序可能会修改cookie中的内容
    - 敏感不能写在cookie，要写需要加密
  - session：存储在服务器上，不存在敏感信息泄露的风险
- 有效期不同
- 对服务器压力不同

# HTTP特性和使用方法

## 编码和解码



# HTTP协议构建应用

# HTTPS

# 基于HTTP的功能追加协议

# Web安全威胁

